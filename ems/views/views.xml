<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
        <!-- top level menu: no parent -->
        <menuitem id="main_ems_menu" name="EMS"/>

        <!-- A first level in the left side menu is needed
             before using action= attribute -->
        <menuitem id="ems_menu" name="EMS"
                  parent="main_ems_menu"/>


        <!--  EMS/SESSIONS -->
        <record model="ir.actions.act_window" id="action_list_sessions">
            <field name="name">Sessions</field>
            <field name="res_model">ems.session</field>
            <field name="view_mode">calendar,tree,form</field>
            <!--field name="context">{"search_default_upcoming":1}</field-->
        </record>

        <!-- the following menuitem should appear *after*
             its parent ems_menu and *after* its
             action action_list_sessions -->
        <menuitem id="menu_ems_session" parent="ems_menu" name="Sessions" sequence="10"
                  action="action_list_sessions"/>

        <!-- Session Tree view -->
        <record model="ir.ui.view" id="view_ems_session_tree">
            <field name="name">Sessions</field>
            <field name="model">ems.session</field>
            <field name="arch" type="xml">
                <tree string="Sessions">
                    <field name="name"/>
                    <field name="service_id"/>
                    <field name="state" invisible="1"/>
                </tree>
            </field>
        </record>

        <!-- Session Form view -->
        <record model="ir.ui.view" id="view_ems_session_form">
            <field name="name">Sessions</field>
            <field name="model">ems.session</field>
            <field name="arch" type="xml">
                <form string="Sessions">
                    <header>
                        <button string="Confirm Session" name="button_confirm" states="draft" type="object"
                                class="oe_highlight" groups="base.group_user"/>
                        <button string="Finish Session" name="button_done" states="confirm" type="object"
                                class="oe_highlight" groups="base.group_user"/>
                        <button string="Set To Draft" name="button_draft" states="cancel,done" type="object"
                                groups="base.group_user"/>
                        <button string="Cancel Session" name="button_cancel" states="draft,confirm" type="object"
                                groups="base.group_user"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,confirm,done"/>
                    </header>
                    <sheet>
                        <div class="oe_title">
                            <label for="name" class="oe_edit_only"/>
                            <h1>
                                <field name="name"/>
                            </h1>
                        </div>
                        <group name="main_field_group">
                            <group colspan="2">
                                <field name="center_id" options="{'no_create': True}"/>
                                <field name="service_id" options="{'no_create': True}"/>
                                <field name="room_id" options="{'no_create': True}"/>
                                <field name="resource_ids" string="Resources" widget="many2many_tags"
                                       options="{'no_create': True}"/>
                            </group>
                            <group>
                                <group>
                                    <field name="customer_id" domain="[('ems_type','=','customer')]"/>
                                    <field name="trainer_id"/>
                                </group>
                                <group>
                                    <field name="date_begin"/>
                                    <field name="date_end"/>
                                </group>
                            </group>
                        </group>
                        <notebook>
                            <page string='Session Details' groups="base.group_no_one">
                                <group colspan="4">
                                    <field name="weight"/>
                                </group>
                            </page>
                            <page string="Description">
                                <field name="description" nolabel="1" placeholder="Session Description..."/>
                            </page>
                        </notebook>
                    </sheet>
                    <!--div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers" groups="base.group_user"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div-->
                </form>
            </field>
        </record>

        <!-- Session Calendar view -->
        <record id="view_ems_session_calendar" model="ir.ui.view">
            <field name="name">ems.session.calendar</field>
            <field name="model">ems.session</field>
            <field eval="2" name="priority"/>
            <field name="arch" type="xml">
                <calendar color="color" date_start="date_begin" date_stop="date_end" string="Session Organization">
                    <field name="customer_id"/>
                    <field name="name"/>
                    <field name="trainer_id"/>
                </calendar>
            </field>
        </record>

        <!-- Session Search view -->
        <record model="ir.ui.view" id="ems_session_search_view">
            <field name="name">ems.session.search</field>
            <field name="model">ems.session</field>
            <field name="arch" type="xml">
                <search>
                    <filter string="My Sessions" help="My Sessions" domain="[('trainer_id','=',uid)]"/>
                    <separator/>
                    <filter string="Upcoming" name="upcoming"
                            domain="[('date_begin','&gt;=', datetime.datetime.combine(context_today(), datetime.time(0,0,0)))]"
                            help="Upcoming sessions from today"/>
                    <separator/>
                    <filter string="Unconfirmed" name="draft" domain="[('state','=','draft')]"
                            help="Events in New state"/>
                    <filter string="Confirmed" domain="[('state','=','confirm')]" help="Confirmed events"/>
                    <field name="customer_id"/>
                    <field name="trainer_id"/>
                    <field name="description"/>
                    <field name="service_id"/>
                    <field name="resource_ids"/>
                    <field name="room_id"/>
                    <field name="name"/>
                    <group expand="0" string="Group By">
                        <filter string="Trainer" context="{'group_by': 'trainer_id'}"/>
                        <filter string="Service" context="{'group_by':'service_id'}"/>
                        <filter string="Status" context="{'group_by':'state'}"/>
                        <filter string="Start Month" domain="[]" context="{'group_by':'date_begin'}"/>
                    </group>
                </search>
            </field>
        </record>


        <!-- ########################## EMS/TIMETABLE ########################## -->
        <record model="ir.actions.act_window" id="action_list_timetable">
            <field name="name">Timetable</field>
            <field name="res_model">ems.timetable</field>
            <field name="view_mode">tree,form,calendar</field>
            <!--field name="context">{"search_default_upcoming":1}</field-->
        </record>

        <!-- the following menuitem should appear *after*
             its parent ems_menu and *after* its
             action action_list_sessions -->
        <menuitem id="menu_ems_timetable" parent="ems_menu" name="Timetable" sequence="20"
                  action="action_list_timetable"/>

        <!-- TIMETABLE Tree view -->
        <record model="ir.ui.view" id="view_ems_timetable_tree">
            <field name="name">Timetable</field>
            <field name="model">ems.timetable</field>
            <field name="arch" type="xml">
                <tree string="Timetable">
                    <field name="center_id"/>
                    <field name="day"/>
                    <field name="ini_time"/>
                    <field name="end_time"/>
                    <field name="trainer_ids"/>
                </tree>
            </field>
        </record>

        <!-- TIMETABLE Form view -->
        <record model="ir.ui.view" id="view_ems_timetable_form">
            <field name="name">Timetable</field>
            <field name="model">ems.timetable</field>
            <field name="arch" type="xml">
                <form string="Timetable">
                    <header>
                    </header>
                    <sheet>
                        <group col="4" colspan="2">
                            <field name="center_id" options="{'no_create': True, 'no_open': True}"/>
                            <field name="day" options="{'no_create': True}"/>
                            <newline/>
                            <field name="ini_time"/>
                            <field name="end_time"/>

                            <!--field name="end_time" string="Resources" widget="many2many_tags" options="{'no_create': True}"/-->
                        </group>
                        <group>
                            <field name="trainer_ids" nolabel="1">
                                <tree editable="botttom">
                                    <field name="sequence" widget="handle"/>
                                    <field name="trainer_id" options="{'no_quick_create': True}"/>
                                </tree>
                            </field>
                        </group>


                    </sheet>
                    <!--div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers" groups="base.group_user"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div-->
                </form>
            </field>
        </record>

        <!-- TIMETABLE Calendar view -->
        <!--record id="view_ems_session_calendar" model="ir.ui.view">
            <field name="name">ems.session.calendar</field>
            <field name="model">ems.session</field>
            <field eval="2" name="priority"/>
            <field name="arch" type="xml">
                <calendar color="service_id" date_start="date_begin" date_stop="date_end" string="Session Organization">
                    <field name="customer_id"/>
                    <field name="name"/>
                    <field name="trainer_id"/>
                </calendar>
            </field>
        </record-->

        <!-- TIMETABLE Search view -->
        <!--record model="ir.ui.view" id="ems_session_search_view">
            <field name="name">ems.session.search</field>
            <field name="model">ems.session</field>
            <field name="arch" type="xml">
                <search>
                    <filter string="My Sessions" help="My Sessions" domain="[('trainer_id','=',uid)]"/>
                    <separator/>
                    <filter string="Upcoming" name="upcoming"
                            domain="[('date_begin','&gt;=', datetime.datetime.combine(context_today(), datetime.time(0,0,0)))]"
                            help="Upcoming sessions from today"/>
                    <separator/>
                    <filter string="Unconfirmed" name="draft" domain="[('state','=','draft')]"
                            help="Events in New state"/>
                    <filter string="Confirmed" domain="[('state','=','confirm')]" help="Confirmed events"/>
                    <field name="customer_id"/>
                    <field name="trainer_id"/>
                    <field name="description"/>
                    <field name="service_id"/>
                    <field name="resource_ids"/>
                    <field name="room_id"/>
                    <field name="name"/>
                    <group expand="0" string="Group By">
                        <filter string="Trainer" context="{'group_by': 'trainer_id'}"/>
                        <filter string="Service" context="{'group_by':'service_id'}"/>
                        <filter string="Status" context="{'group_by':'state'}"/>
                        <filter string="Start Month" domain="[]" context="{'group_by':'date_begin'}"/>
                    </group>
                </search>
            </field>
        </record-->


        <!-- ########################## EMS/TRAINER ########################## -->
        <record model="ir.actions.act_window" id="action_list_trainer">
            <field name="name">Trainer</field>
            <field name="res_model">ems.trainer</field>
            <field name="view_mode">tree,form</field>
        </record>

        <!-- the following menuitem should appear *after*
             its parent ems_menu and *after* its
             action action_list_sessions -->
        <menuitem id="menu_ems_trainer" parent="ems_menu" name="Trainer" sequence="30"
                  action="action_list_trainer"/>

        <!-- TRAINER Tree view -->
        <record model="ir.ui.view" id="view_ems_trainer_tree">
            <field name="name">Trainer</field>
            <field name="model">ems.trainer</field>
            <field name="arch" type="xml">
                <tree string="Trainer">
                    <field name="user_id"/>
                    <field name="timetable_ids"/>
                </tree>
            </field>
        </record>

        <!-- TRAINER Form view -->
        <record model="ir.ui.view" id="view_ems_trainer_form">
            <field name="name">Trainer</field>
            <field name="model">ems.trainer</field>
            <field name="arch" type="xml">
                <form string="Trainer">
                    <header>
                    </header>
                    <sheet>
                        <group col="4" colspan="2">
                            <field name="user_id" options="{'no_create': True, 'no_open': True}"/>
                            <field name="color"/>
                            <newline/>
                            <field name="description"/>
                        </group>
                        <group string="Absences">
                            <field name="absence_ids" nolabel="1">
                                <tree editable="bottom">
                                    <field name="center_id"/>
                                    <field name="ini_date"/>
                                    <field name="end_date"/>
                                </tree>
                            </field>
                        </group>
                        <group string="Timetables">
                            <field name="timetable_ids" nolabel="1" attrs="{'readonly':True}">
                                <tree default_order="center_id, day, ini_time"> <!-- create="0" delete="0" edit="0"-->
                                    <field name="center_id"/>
                                    <field name="day"/>
                                    <field name="ini_time"/>
                                    <field name="end_time"/>
                                </tree>
                            </field>
                        </group>
                        <group string="Upcoming sessions">
                            <field name="session_ids" nolabel="1" attrs="{'readonly':True}">
                                <tree>
                                    <field name="name"/>
                                    <field name="center_id"/>
                                    <field name="service_id"/>
                                    <field name="room_id"/>
                                    <field name="customer_id"/>
                                    <field name="date_begin"/>
                                    <field name="date_end"/>
                                </tree>
                            </field>
                        </group>


                    </sheet>
                    <!--div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers" groups="base.group_user"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div-->
                </form>
            </field>
        </record>

        <!-- TRAINER Calendar view -->
        <!--record id="view_ems_session_calendar" model="ir.ui.view">
            <field name="name">ems.session.calendar</field>
            <field name="model">ems.session</field>
            <field eval="2" name="priority"/>
            <field name="arch" type="xml">
                <calendar color="service_id" date_start="date_begin" date_stop="date_end" string="Session Organization">
                    <field name="customer_id"/>
                    <field name="name"/>
                    <field name="trainer_id"/>
                </calendar>
            </field>
        </record-->

        <!-- TRAINER Search view -->
        <!--record model="ir.ui.view" id="ems_session_search_view">
            <field name="name">ems.session.search</field>
            <field name="model">ems.session</field>
            <field name="arch" type="xml">
                <search>
                    <filter string="My Sessions" help="My Sessions" domain="[('trainer_id','=',uid)]"/>
                    <separator/>
                    <filter string="Upcoming" name="upcoming"
                            domain="[('date_begin','&gt;=', datetime.datetime.combine(context_today(), datetime.time(0,0,0)))]"
                            help="Upcoming sessions from today"/>
                    <separator/>
                    <filter string="Unconfirmed" name="draft" domain="[('state','=','draft')]"
                            help="Events in New state"/>
                    <filter string="Confirmed" domain="[('state','=','confirm')]" help="Confirmed events"/>
                    <field name="customer_id"/>
                    <field name="trainer_id"/>
                    <field name="description"/>
                    <field name="service_id"/>
                    <field name="resource_ids"/>
                    <field name="room_id"/>
                    <field name="name"/>
                    <group expand="0" string="Group By">
                        <filter string="Trainer" context="{'group_by': 'trainer_id'}"/>
                        <filter string="Service" context="{'group_by':'service_id'}"/>
                        <filter string="Status" context="{'group_by':'state'}"/>
                        <filter string="Start Month" domain="[]" context="{'group_by':'date_begin'}"/>
                    </group>
                </search>
            </field>
        </record-->

        <!-- ########################## EMS/TRAINER AVAILABILITY ########################## -->
        <record model="ir.actions.act_window" id="action_list_timetable_trainer">
            <field name="name">Trainer availability</field>
            <field name="res_model">ems.timetable.trainer</field>
            <field name="view_mode">calendar,tree,form</field>
        </record>

        <!-- the following menuitem should appear *after*
             its parent ems_menu and *after* its
             action action_list_sessions -->
        <menuitem id="menu_ems_timetable_trainer" parent="ems_menu" name="Trainer availability" sequence="40"
                  action="action_list_timetable_trainer"/>

        <!-- TRAINER AVAILABILITY Tree view -->
        <record model="ir.ui.view" id="view_ems_timetable_trainer_tree">
            <field name="name">Trainer availability</field>
            <field name="model">ems.timetable.trainer</field>
            <field name="arch" type="xml">
                <tree string="Trainer availability">
                    <field name="timetable_id"/>
                    <field name="trainer_id"/>
                </tree>
            </field>
        </record>

        <!-- TRAINER AVAILABILITY Form view -->
        <record model="ir.ui.view" id="view_ems_timetable_trainer_form">
            <field name="name">Trainer availability</field>
            <field name="model">ems.timetable.trainer</field>
            <field name="arch" type="xml">
                <form string="Trainer availability">
                    <header>
                    </header>
                    <sheet>
                        <group col="4" colspan="2">
                            <field name="timetable_id" options="{'no_create': True}"/>
                            <field name="trainer_id" options="{'no_create': True}"/>
                            <newline/>
                            <field name="date_begin"/>
                            <field name="date_end"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- TRAINER AVAILABILITY Calendar view -->
        <record id="view_ems_timetable_trainer_calendar" model="ir.ui.view">
            <field name="name">Trainer availability</field>
            <field name="model">ems.timetable.trainer</field>
            <field eval="2" name="priority"/>
            <field name="arch" type="xml">
                <calendar color="color" date_start="date_begin" date_stop="date_end" string="Trainer availability" mode="week">
                    <field name="center_id"/>
                    <field name="trainer_id"/>
                </calendar>
            </field>
        </record>

        <!-- TRAINER AVAILABILITY Search view -->
        <!--record model="ir.ui.view" id="ems_session_search_view">
            <field name="name">ems.session.search</field>
            <field name="model">ems.session</field>
            <field name="arch" type="xml">
                <search>
                    <filter string="My Sessions" help="My Sessions" domain="[('trainer_id','=',uid)]"/>
                    <separator/>
                    <filter string="Upcoming" name="upcoming"
                            domain="[('date_begin','&gt;=', datetime.datetime.combine(context_today(), datetime.time(0,0,0)))]"
                            help="Upcoming sessions from today"/>
                    <separator/>
                    <filter string="Unconfirmed" name="draft" domain="[('state','=','draft')]"
                            help="Events in New state"/>
                    <filter string="Confirmed" domain="[('state','=','confirm')]" help="Confirmed events"/>
                    <field name="customer_id"/>
                    <field name="trainer_id"/>
                    <field name="description"/>
                    <field name="service_id"/>
                    <field name="resource_ids"/>
                    <field name="room_id"/>
                    <field name="name"/>
                    <group expand="0" string="Group By">
                        <filter string="Trainer" context="{'group_by': 'trainer_id'}"/>
                        <filter string="Service" context="{'group_by':'service_id'}"/>
                        <filter string="Status" context="{'group_by':'state'}"/>
                        <filter string="Start Month" domain="[]" context="{'group_by':'date_begin'}"/>
                    </group>
                </search>
            </field>
        </record-->



        <!-- ########################## EMS/CONFIGURATION ########################## -->

        <menuitem name="Configuration" id="menu_ems_config_root" parent="main_ems_menu" sequence="30"/>


        <!-- ########################## EMS/CONFIGURATION/Center ########################## -->
        <record model="ir.ui.view" id="view_ems_center_form">
            <field name="name">Center</field>
            <field name="model">ems.center</field>
            <field name="arch" type="xml">
                <form string="Center">
                    <group col="4">
                        <field name="name"/>
                    </group>
                    <group col="2">
                        <field name="description"/>
                    </group>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="view_ems_enter_tree">
            <field name="name">Center</field>
            <field name="model">ems.center</field>
            <field name="arch" type="xml">
                <tree string="Center">
                    <field name="name"/>
                    <!--field name="description"/-->
                </tree>
            </field>
        </record>

        <record model="ir.actions.act_window" id="action_center">
            <field name="name">Center</field>
            <field name="res_model">ems.center</field>
            <field name="view_type">form</field>
        </record>
        <menuitem name="Centers" id="menu_center" action="action_center" parent="menu_ems_config_root"
                  groups="base.group_no_one"/>

        <!-- EMS/CONFIGURATION/Service -->
        <record model="ir.ui.view" id="view_ems_service_form">
            <field name="name">Service</field>
            <field name="model">ems.service</field>
            <field name="arch" type="xml">
                <form string="Service">
                    <group col="4">
                        <field name="name"/>
                        <field name="color"/>
                    </group>
                    <group col="2">
                        <field name="description"/>
                    </group>
                    <field name="room_ids">
                        <tree string="Printing order" editable="botttom">
                            <field name="sequence" widget="handle"/>
                            <field name="room_id"/>
                            <field name="resource_ids" widget="many2many_tags"/>
                        </tree>
                    </field>

                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="view_ems_service_tree">
            <field name="name">Service</field>
            <field name="model">ems.service</field>
            <field name="arch" type="xml">
                <tree string="Service">
                    <field name="name"/>
                    <field name="color"/>
                </tree>
            </field>
        </record>

        <record model="ir.actions.act_window" id="action_service">
            <field name="name">Service</field>
            <field name="res_model">ems.service</field>
            <field name="view_type">form</field>
        </record>

        <menuitem name="Services" id="menu_service" action="action_service" parent="menu_ems_config_root"
                  groups="base.group_no_one"/>

        <!-- EMS/CONFIGURATION/Room -->
        <record model="ir.ui.view" id="view_ems_room_form">
            <field name="name">Room</field>
            <field name="model">ems.room</field>
            <field name="arch" type="xml">
                <form string="Room">
                    <group col="4">
                        <field name="name"/>
                        <field name="center_id"/>
                    </group>
                    <group col="2">
                        <field name="description"/>
                    </group>
                    <group col="2">
                        <field name="service_ids">
                            <tree string="Printing order"> <!-- editable="botttom"-->
                                <field name="sequence" widget="handle"/>
                                <field name="service_id"/>
                                <field name="resource_ids" widget="many2many_tags"/>
                            </tree>
                        </field>
                    </group>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="view_ems_room_tree">
            <field name="name">Room</field>
            <field name="model">ems.room</field>
            <field name="arch" type="xml">
                <tree string="Room">
                    <field name="name"/>
                    <!--field name="description"/-->
                </tree>
            </field>
        </record>

        <record model="ir.actions.act_window" id="action_room">
            <field name="name">Room</field>
            <field name="res_model">ems.room</field>
            <field name="view_type">form</field>
        </record>
        <menuitem name="Rooms" id="menu_room" action="action_room" parent="menu_ems_config_root"
                  groups="base.group_no_one"/>


        <!-- EMS/CONFIGURATION/Room_Service -->
        <record model="ir.ui.view" id="view_ems_room_service_form">
            <field name="name">Room Service</field>
            <field name="model">ems.room.service.rel</field>
            <field name="arch" type="xml">
                <form string="Room Service">
                    <group>
                        <field name="sequence" invisible="1"/>
                        <field name="service_id"/>
                    </group>
                    <group col="4">
                        <field name="resource_ids" widget="many2many"/>
                    </group>
                </form>
            </field>
        </record>

        <!-- EMS/CONFIGURATION/Resource -->
        <record model="ir.ui.view" id="view_ems_resource_form">
            <field name="name">Resource</field>
            <field name="model">ems.resource</field>
            <field name="arch" type="xml">
                <form string="Resource">
                    <group col="4">
                        <field name="name"/>
                        <field name="center_id"/>
                    </group>
                    <group col="2">
                        <field name="description"/>
                    </group>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="view_ems_resource_tree">
            <field name="name">Resource</field>
            <field name="model">ems.resource</field>
            <field name="arch" type="xml">
                <tree string="Resource">
                    <field name="name"/>
                    <!--field name="description"/-->
                </tree>
            </field>
        </record>

        <record model="ir.actions.act_window" id="action_resource">
            <field name="name">Resource</field>
            <field name="res_model">ems.resource</field>
            <field name="view_type">form</field>
        </record>
        <menuitem name="Resources" id="menu_resource" action="action_resource" parent="menu_ems_config_root"
                  groups="base.group_no_one"/>


        <!-- Creem el wizard form -->
        <record model="ir.ui.view" id="wizard_form_view">
            <field name="name">wizard.form</field>
            <field name="model">ems.wizard</field>
            <field name="arch" type="xml">
                <form string="Generate sessions">
                    <group>
                        <field name="session_id"/>
                        <field name="count"/>
                    </group>
                    <footer>
                        <button name="generate" type="object"
                                string="Generate" class="oe_highlight"/>
                        or
                        <button special="cancel" string="Cancel"/>
                    </footer>
                </form>
            </field>
        </record>

        <!-- posem el link al wizard forma netiro al menu  "mas" del registr -->
        <act_window id="launch_session_wizard"
                    name="Generate sessions"
                    src_model="ems.session"
                    res_model="ems.wizard"
                    view_mode="form"
                    target="new"
                    key2="client_action_multi"/>


    </data>
</openerp>
